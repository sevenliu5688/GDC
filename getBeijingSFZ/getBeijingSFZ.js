function getAllStationInBeijing(n){$.ajax({url:'https://api.tianditu.gov.cn/search?postStr={"yingjiType":0,"sourceType":0,"keyWord":"'+tiandituSearchStr+'","level":10,"mapBound":"115.41962,39.67971,117.46307,40.36643","queryType":1,"start":0,"count":500,"queryTerminal":10000}&type=query&tk=2ce94f67e58faa24beb7cb8a09780552',type:"GET",async:!1,data:{},dataType:"json",success:function(t){$("body").append("获取北京市所有收费站，成功！<br>"),n(t)},error:function(){$("body").append("获取北京市所有收费站，失败！<br>")}})}function getPositionInfoFromThirdMap(n){var t=[];if(n&&n.pois&&n.pois.length>0){stationNum=n.pois.length;for(var a=0;a<n.pois.length;a++)if(-1!=n.pois[a].name.indexOf("收费站")){for(var e=!1,o=0;o<blackPatterns.length;o++)if(n.pois[a].name.indexOf(blackPatterns[o])>-1){blackStatioins.push(n.pois[a].name),e=!0;break}if(!e){var i=getUniqueStatioinBySynonym(n.pois[a].name);tempTidndituPositionInfo[i]={name:i,lonlat:n.pois[a].lonlat},t.push(i)}}t=unique(t),uniqueStationNum=t.length,$("body").append("共获取结果数："+stationNum+"个，去重后数量："+uniqueStationNum+'个。<span style="color: gray;">（去重规则：先筛选出名称包含"收费站"，且不在黑名单中站，再去重。）</span><br>'),$("body").append('<div><span id="status_requesting_thirdapi">正在请求第</span><span id="num_requesting_thirdapi"">1</span>/'+uniqueStationNum+"个收费站的位置信息，用于判断是否有效高速收费站（请求自第三方地图api）</div>");for(var a=0;a<t.length;a++)postThirdMap(t[a],a)}}function postThirdMap(positionName,i){var jsonpCallback="success_jsonpCallback"+i;window[jsonpCallback]=success_jsonpCallback(positionName);var url1="https://restapi.amap.com/v3/place/text?key=736b76818274792c4428be1f634567a7&keywords=北京 "+positionName+"&output=JSON&callback="+jsonpCallback+"&extensions=all",url2="https://map.baidu.com/?newmap=1&reqflag=pcmap&biz=1&from=webmap&da_par=direct&pcevaname=pc4.1&qt=nb&r=1000&c=131&wd=高速公路&uid=1e42c8eea7fc2132b21e36d6&b=(12925331.28,4803099.97;12940211.28,4810571.97)&l=15&gr_radius=1000&pn=0&auth=VMD5RNx%40y%3D%40KVSKGUzfOSDMMAyH4B0O%40uxHLBNRRxVVtzljPyBYYxy1uVt1GgvPUDZYOYIZuztFexLwWvGccZcuVtPWv3GuLt8BnlQcWlADEGJM5S7YZzlEeLZNz18DaDVcCEB8zvAua%40QwBvgw4vjlBhlADM5GS77ZJZzeh33uTtAffbD9&device_ratio=2&tn=B_NORMAL_MAP&nn=0&u_loc=12746855,4559936&ie=utf-8&t=1563788112261";$.ajax({url:url1,type:"GET",async:!0,dataType:"json",contentType:"application/json; charset=utf-8",success:function(n,t,a){},error:function(a,b,c){eval(a.responseText)}})}function success_jsonpCallback(n){return function(t){t.positionName=n,$("#num_requesting_thirdapi").length<1&&$("body").append('<div><span id="status_requesting_thirdapi">正在请求第</span><span id="num_requesting_thirdapi""></span>/'+uniqueStationNum+"个收费站的位置信息，用于判断是否有效高速收费站（请求自第三方地图api）</div>"),tempThirdPositionInfos.push(t),$("#num_requesting_thirdapi").html(tempThirdPositionInfos.length),tempThirdPositionInfos.length>0&&tempThirdPositionInfos.length==uniqueStationNum&&(filterStation2(),$("#num_requesting_thirdapi").css("color","green"),$("#status_requesting_thirdapi").html("请求完成"))}}function filterStation(){$("body").append("开始过滤是否属于北京21条高速的境内收费站：（共需过滤"+tempThirdPositionInfos.length+"个）<br>");for(var n=0;n<tempThirdPositionInfos.length;n++){var t=isMatchPattern(tempThirdPositionInfos[n]),a=isIn21HighRoad(tempThirdPositionInfos[n]);a?realStations.push(a):t?notsureStations.push(t):notsureStations2.push({stationName:tempThirdPositionInfos[n].result.wd,relatedAddrs:function(n){var t=[];if(n&&n.content&&n.content.length>0)for(var a=0;a<n.content.length;a++)t.push(n.content[a].addr);return unique(t)}(tempThirdPositionInfos[n])})}$("body").append("（一）属于北京21条高速的境内收费站：（共计"+realStations.length+"个）<br>");for(var n=0;n<realStations.length;n++)$("body").append(formatNum(n+1)+"，"+JSON.stringify(realStations[n])+"<br>");realStations.length<1&&$("body").append("无"),$("body").append("<br>（二）可能不属于北京21条高速的境内收费站1（需手动判断，如果是的话，请加入白名单）：（共计"+notsureStations.length+"个）<br>");for(var n=0;n<notsureStations.length;n++)$("body").append(formatNum(n+1)+"，"+JSON.stringify(notsureStations[n])+"<br>");notsureStations.length<1&&$("body").append("无"),$("body").append("<br>（三）可能不属于北京21条高速的境内收费站2（需手动判断，如果是的话，请加入白名单）：（共计"+notsureStations2.length+"个）<br>");for(var n=0;n<notsureStations2.length;n++)$("body").append(formatNum(n+1)+"，"+JSON.stringify(notsureStations2[n])+"<br>");notsureStations2.length<1&&$("body").append("无"),$("body").append("<br>（四）其中被黑名单关键词过滤掉的有：<br>");for(var n=0;n<blackStatioins.length;n++)$("body").append(gray(formatNum(n+1)+"，"+JSON.stringify(blackStatioins[n])+"<br>"));blackStatioins.length<1&&$("body").append("无")}function filterStation2(){$("body").append("开始过滤是否属于北京21条高速的境内收费站：（共需过滤"+tempThirdPositionInfos.length+"个）<br>");for(var n=0;n<tempThirdPositionInfos.length;n++){var t=isMatchPattern2(tempThirdPositionInfos[n]),a=isIn21HighRoad2(tempThirdPositionInfos[n]);a?realStations.push(a):t?notsureStations.push(t):notsureStations2.push({stationName:tempThirdPositionInfos[n].positionName,relatedAddrs:function(n){var t=[];if(n&&n.pois&&n.pois.length>0)for(var a=0;a<n.pois.length;a++)t.push(n.pois[a].name);return unique(t)}(tempThirdPositionInfos[n])})}$("body").append("（一）属于北京21条高速的境内收费站：（共计"+realStations.length+"个）<br>");for(var n=0;n<realStations.length;n++)$("body").append(formatNum(n+1)+"，"+JSON.stringify(realStations[n])+"<br>");realStations.length<1&&$("body").append("无"),$("body").append("<br>（二）可能不属于北京21条高速的境内收费站1（需手动判断，如果是的话，请加入白名单）：（共计"+notsureStations.length+"个）<br>");for(var n=0;n<notsureStations.length;n++)$("body").append(formatNum(n+1)+"，"+JSON.stringify(notsureStations[n])+"<br>");notsureStations.length<1&&$("body").append("无"),$("body").append("<br>（三）可能不属于北京21条高速的境内收费站2（需手动判断，如果是的话，请加入白名单）：（共计"+notsureStations2.length+"个）<br>");for(var n=0;n<notsureStations2.length;n++)$("body").append(formatNum(n+1)+"，"+JSON.stringify(notsureStations2[n])+"<br>");notsureStations2.length<1&&$("body").append("无"),$("body").append("<br>（四）其中被黑名单关键词过滤掉的有：<br>");for(var n=0;n<blackStatioins.length;n++)$("body").append(gray(formatNum(n+1)+"，"+JSON.stringify(blackStatioins[n])+"<br>"));blackStatioins.length<1&&$("body").append("无")}function unique(n){return Array.from(new Set(n))}function unique2(n){for(var t=unique(n),a=0;a<synonymStation.length;a++)for(var e=0;e<t.length;e++)for(var o=0;o<synonymStation[a].synonyms.length;o++)t[e]==synonymStation[a].synonyms[o]&&(t[e]=synonymStation[a].stationName);return unique(t)}function getUniqueStatioinBySynonym(n){for(var t=0;t<synonymStation.length;t++)for(var a=0;a<synonymStation[t].synonyms.length;a++)if(n==synonymStation[t].synonyms[a])return synonymStation[t].stationName;return n}function red(n){return'<span style="color:red;">'+n+"</span>"}function gray(n){return'<span style="color:gray;">'+n+"</span>"}function blod(n){return'<span style="color:red;">'+n+"</span>"}function formatNum(n){return n<10?"&nbsp;&nbsp;&nbsp;"+n:n<100?"&nbsp;&nbsp;"+n:n<1e3?"&nbsp;"+n:n<1e4?""+n:n}function isMatchPattern(n){for(var t=0;t<whitePatterns.length;t++)if(-1!=n.result.wd.indexOf(whitePatterns[t])){var a=null;if(n&&n.content&&n.content.length>0)for(var t=0;t<n.content.length;t++){for(var e=0;e<patterns.length;e++)if(-1!=n.content[t].addr.indexOf(patterns[e])){a=n.content[t].addr;break}if(a)break}return assemblyStation(n,a)}if(n&&n.content&&n.content.length>0)for(var t=0;t<n.content.length;t++)for(var e=0;e<patterns.length;e++)if(-1!=n.content[t].addr.indexOf(patterns[e]))return assemblyStation(n,n.content[t].addr);return!1}function isMatchPattern2(n){for(var t=0;t<whitePatterns.length;t++)if(-1!=n.positionName.indexOf(whitePatterns[t])){var a=null;if(n&&n.pois&&n.pois.length>0)for(var t=0;t<n.pois.length;t++){for(var e=0;e<patterns.length;e++)if(-1!=n.pois[t].name.indexOf(patterns[e])){a=n.pois[t].name;break}if(a)break}return assemblyStation(n,a)}if(n&&n.pois&&n.pois.length>0)for(var t=0;t<n.pois.length;t++)for(var e=0;e<patterns.length;e++)if(-1!=n.pois[t].name.indexOf(patterns[e]))return assemblyStation(n,n.pois[t].name);return!1}function isIn21HighRoad(n){for(var t=0;t<whitePatterns.length;t++)if(-1!=n.result.wd.indexOf(whitePatterns[t])){var a=null;if(n&&n.content&&n.content.length>0)for(var t=0;t<n.content.length;t++){for(var e=0;e<patterns.length;e++)if(-1!=n.content[t].addr.indexOf(patterns[e])){a=n.content[t].addr;break}if(a)break}return assemblyStation(n,a,null,null)}if(n&&n.content&&n.content.length>0)for(var t=0;t<n.content.length;t++)for(var e=0;e<highRoad21.length;e++){if(n.result.wd.indexOf(whitePatterns[t]),-1!=n.content[t].addr.indexOf(highRoad21[e].shortName))return assemblyStation(n,n.content[t].addr,highRoad21[e].no,highRoad21[e].name);if(highRoad21[e].patterns)for(var o=0;o<highRoad21[e].patterns.length;o++)if(-1!=n.content[t].addr.indexOf(highRoad21[e].patterns[o]))return assemblyStation(n,n.content[t].addr,highRoad21[e].no,highRoad21[e].name);if(highRoad21[e].sfzs)for(var o=0;o<highRoad21[e].sfzs.length;o++)if(-1!=n.content[t].addr.indexOf(highRoad21[e].sfzs[o])||-1!=n.result.wd.indexOf(highRoad21[e].sfzs[o]))return assemblyStation(n,n.content[t].addr,highRoad21[e].no,highRoad21[e].name)}else for(var e=0;e<highRoad21.length;e++)if(highRoad21[e].sfzs)for(var o=0;o<highRoad21[e].sfzs.length;o++)if(-1!=n.result.wd.indexOf(highRoad21[e].sfzs[o]))return assemblyStation(n,null,highRoad21[e].no,highRoad21[e].name);return!1}function isIn21HighRoad2(n){for(var t=0;t<whitePatterns.length;t++)if(-1!=n.positionName.indexOf(whitePatterns[t])){var a=null;if(n&&n.pois&&n.pois.length>0)for(var t=0;t<n.pois.length;t++){for(var e=0;e<patterns.length;e++)if(-1!=n.pois[t].name.indexOf(patterns[e])){a=n.pois[t].name;break}if(a)break}return assemblyStation(n,a,null,null)}if(n&&n.pois&&n.pois.length>0)for(var t=0;t<n.pois.length;t++)for(var e=0;e<highRoad21.length;e++){if(n.positionName.indexOf(whitePatterns[t]),-1!=n.pois[t].name.indexOf(highRoad21[e].shortName))return assemblyStation(n,n.pois[t].name,highRoad21[e].no,highRoad21[e].name);if(highRoad21[e].patterns)for(var o=0;o<highRoad21[e].patterns.length;o++)if(-1!=n.pois[t].name.indexOf(highRoad21[e].patterns[o]))return assemblyStation(n,n.pois[t].name,highRoad21[e].no,highRoad21[e].name);if(highRoad21[e].sfzs)for(var o=0;o<highRoad21[e].sfzs.length;o++)if(-1!=n.pois[t].name.indexOf(highRoad21[e].sfzs[o])||-1!=n.positionName.indexOf(highRoad21[e].sfzs[o]))return assemblyStation(n,n.pois[t].name,highRoad21[e].no,highRoad21[e].name)}else for(var e=0;e<highRoad21.length;e++)if(highRoad21[e].sfzs)for(var o=0;o<highRoad21[e].sfzs.length;o++)if(-1!=n.positionName.indexOf(highRoad21[e].sfzs[o]))return assemblyStation(n,null,highRoad21[e].no,highRoad21[e].name);return!1}function assemblyStation(n,t,a,e){return{stationName:n.result?n.result.wd:n.positionName,addr:t,highRoadNo:a,highRoadName:e,lonlat:tempTidndituPositionInfo[n.result?n.result.wd:n.positionName].lonlat}}var realStations=[],notsureStations=[],notsureStations2=[],tiandituSearchStr=["北京市","收费站"].join("\\b"),stationNum=0,uniqueStationNum=0,tempThirdPositionInfos=[],tempTidndituPositionInfo={},patterns=["高速","G","五环","六环"],blackPatterns=["便利店","热力","燃气","销售","加油站","自行车","电视","充电","未来科技城收费站","公交站"],whitePatterns=[],blackStatioins=[],highRoad21=[{no:"G1",name:"京哈高速公路",shortName:"京哈",patterns:["京沈","通燕"]},{no:"G2",name:"京沪高速公路",shortName:"京沪",patterns:["京津塘"],sfzs:["采育收费站"]},{no:"G102",name:"通藏高速公路",shortName:"通藏"},{no:"G103",name:"京通快速路",shortName:"京通"},{no:"G6",name:"京藏高速公路",shortName:"京藏",patterns:["京张","八达岭","营城子"]},{no:"G4",name:"京港澳高速公路",shortName:"京港澳",patterns:["京石高速公路","杜家坎桥"],sfzs:["京良桥收费站"]},{no:"G106",name:"京开高速公路",shortName:"京开"},{no:"G45",name:"大广高速公路",shortName:"大广",sfzs:["宽沟收费站","大礼路收费站","榆垡收费站"]},{no:"S11",name:"京承高速公路",shortName:"京承"},{no:"S32",name:"京平高速公路",shortName:"京平",sfzs:["打铁庄收费站"]},{no:"S28",name:"机场北线高速",shortName:"机场北线",patterns:["北线"]},{no:"S51",name:"机场第二高速",shortName:"机场第二",sfzs:["岗山收费站"]},{no:"S12",name:"机场高速公路",shortName:"机场高速",sfzs:["天竺2号匝道收费站"]},{no:"G7",name:"京新高速公路",shortName:"京新",patterns:["京包","莲花滩"],sfzs:["沙阳收费站","西坨收费站"]},{no:"G4501",name:"六环路",shortName:"六环",patterns:["北京绕城高速公路","绕城高速"],sfzs:["念坛收费站","常屯收费站","六元桥收费站","徐辛庄收费站"]},{no:"S15",name:"京津高速公路",shortName:"京津"},{no:"G101",name:"京密高速公路",shortName:"京密"},{no:"G5",name:"京昆高速公路",shortName:"京昆",patterns:["京石第二高速公路"],sfzs:["张坊收费站","长沟收费站","镇江营收费站","大苑村收费站","襄驸马收费站","石门营收费站"]},{no:"G3",name:"京台高速公路",shortName:"京台"},{no:"G0121",name:"京秦高速公路",shortName:"京秦"},{no:"S3801",name:"京礼高速公路",shortName:"京礼"},{no:"G95",name:"首都环线高速",shortName:"首都环线",patterns:["首环","密涿","承平"],sfzs:["采育收费站"]}],synonymStation=[{stationName:"京良桥收费站",synonyms:["京良收费站","京良桥收费站"]},{stationName:"上清收费站",synonyms:["上清收费站","上清东收费站","上清西收费站"]},{stationName:"清河收费站",synonyms:["清河北收费站","清河收费站"]}],repeatStation=["沙阳收费站"];$(function(){var n=getAllStationInBeijing(getPositionInfoFromThirdMap);console.log(JSON.stringify(n))});